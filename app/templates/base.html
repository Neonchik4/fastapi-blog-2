<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <link rel="icon" type="image/svg+xml" href="/static/favicon.svg">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    {% if current_user %}
    <meta name="user-id" content="{{ current_user.id }}">
    {% else %}
    <meta name="user-id" content="">
    {% endif %}
    <title>{% block title %}FastAPI Blog{% endblock %}</title>
    <script>
        // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ç–µ–º—É –î–û –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∏–ª–µ–π, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –º–∏–≥–∞–Ω–∏—è
        (function() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
        })();
    </script>
    <link rel="stylesheet" href="/static/css/posts.css">
    <link rel="stylesheet" href="/static/css/base.css">
    {% block head_extra %}{% endblock %}
</head>
<body>
{% block header %}
<header class="topbar">
    <div class="topbar-content">
        <div class="logo-section">
            <a href="/" class="logo">FastAPI Blog</a>
            <a href="/" class="button home-button">–ì–ª–∞–≤–Ω–∞—è</a>
            {% if current_user %}
            <a href="/blogs/liked/" class="button liked-button">–ü–æ–Ω—Ä–∞–≤–∏–≤—à–∏–µ—Å—è</a>
            <a href="/stats/" class="button stats-button">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</a>
            {% endif %}
        </div>
        <div class="auth-controls">
            <button id="theme-toggle" class="theme-toggle" aria-label="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É">
                <span id="theme-icon">üåô</span>
            </button>
            {% if current_user %}
                <div class="profile-dropdown" id="profile-dropdown">
                    <a href="/profile/" class="button profile-button" id="profile-button">{{ current_user.first_name }} ‚ñº</a>
                    <div class="profile-dropdown-content" id="profile-dropdown-content">
                        <a href="/profile/" class="profile-link">–ü—Ä–æ—Ñ–∏–ª—å</a>
                        <a href="/blogs/drafts/" class="drafts-link">–ß–µ—Ä–Ω–æ–≤–∏–∫–∏</a>
                        {% if current_user.role.name == 'Admin' or current_user.role.name == 'SuperAdmin' %}
                        <a href="/blogs/all-drafts/" class="all-drafts-link">–í—Å–µ —á–µ—Ä–Ω–æ–≤–∏–∫–∏</a>
                        {% endif %}
                    </div>
                </div>
                <a href="/blogs/create/" class="button success">–°–æ–∑–¥–∞—Ç—å –±–ª–æ–≥</a>
                <form action="/auth/logout/" method="post" class="inline-form">
                    <button type="submit" class="button danger">–í—ã–π—Ç–∏</button>
                </form>
            {% else %}
                <a href="/auth/?mode=login" class="button primary">–í–æ–π—Ç–∏</a>
                <a href="/auth/?mode=register" class="button secondary">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</a>
            {% endif %}
        </div>
    </div>
</header>
{% endblock %}
<main>
    {% block content %}{% endblock %}
</main>
{% block scripts %}{% endblock %}
<script src="/static/js/theme.js"></script>
<script>
// –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—ã–ø–∞–¥–∞—é—â–∏–º —Å–ø–∏—Å–∫–æ–º –ø—Ä–æ—Ñ–∏–ª—è
(function() {
    const profileDropdown = document.getElementById('profile-dropdown');
    const profileButton = document.getElementById('profile-button');
    const dropdownContent = document.getElementById('profile-dropdown-content');
    let hideTimeout = null;
    let autoHideTimeout = null;
    
    if (!profileDropdown || !profileButton || !dropdownContent) return;
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –∫–Ω–æ–ø–∫—É
    profileButton.addEventListener('click', function(e) {
        e.preventDefault();
        e.stopPropagation();
        
        // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º –≤–∏–¥–∏–º–æ—Å—Ç—å
        const isVisible = dropdownContent.classList.contains('show');
        
        if (isVisible) {
            hideDropdown();
        } else {
            showDropdown();
        }
    });
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ –Ω–∞ dropdown
    profileDropdown.addEventListener('mouseenter', function() {
        clearTimeout(hideTimeout);
        clearTimeout(autoHideTimeout);
        showDropdown();
    });
    
    // –°–∫—Ä—ã–≤–∞–µ–º —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π 1.5 —Å–µ–∫—É–Ω–¥—ã –ø—Ä–∏ —É—Ö–æ–¥–µ –º—ã—à–∫–∏
    profileDropdown.addEventListener('mouseleave', function() {
        hideTimeout = setTimeout(function() {
            hideDropdown();
        }, 1500);
    });
    
    // –°–∫—Ä—ã–≤–∞–µ–º –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ dropdown
    document.addEventListener('click', function(e) {
        if (!profileDropdown.contains(e.target)) {
            hideDropdown();
        }
    });
    
    function showDropdown() {
        clearTimeout(hideTimeout);
        clearTimeout(autoHideTimeout);
        dropdownContent.classList.add('show');
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫—Ä—ã–≤–∞–µ–º —á–µ—Ä–µ–∑ 6 —Å–µ–∫—É–Ω–¥
        autoHideTimeout = setTimeout(function() {
            hideDropdown();
        }, 6000);
    }
    
    function hideDropdown() {
        clearTimeout(hideTimeout);
        clearTimeout(autoHideTimeout);
        dropdownContent.classList.remove('show');
    }
})();
</script>
</body>
</html>
